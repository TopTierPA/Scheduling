<iframe 
  id="map-iframe" 
  src="https://toptierpa.github.io/Scheduling/" 
  style="width: 100%; height: 400px; border: 1px solid black;"
></iframe>

<script>
  const mapIframe = document.getElementById('map-iframe');

  // âœ… Always register listener first
  window.addEventListener('message', (event) => {
    console.log('Parent received message:', event.data, 'from', event.origin);

    // TEMP: accept messages from any origin for testing
    // if (event.origin !== 'https://toptierpa.github.io') return;

    if (event.data.type === 'iframe-ready') {
      console.log('Iframe ready! Sending payload...');
      mapIframe.contentWindow.postMessage(
        { dealId: '33265', scheduleType: 'single' },
        '*'  // allow all origins for testing
      );
    } 

    if (event.data.type === 'iframe-response') {
      console.log('Parent received response from iframe:', event.data);
      alert(`Iframe says: ${event.data.message}`);
    }
  });
</script>
